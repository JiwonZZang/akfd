$('<%=j render 'show_post' %>').appendTo($('#modal_board'))

// modal close button click
// modal close button click
$('.modal_close').click(function(){
	$('#modal_bg').click();
})	
// modal close button click end


// 한번 불러주고 이미지 로드 다되면 다시부른다
changeWidthHeightModalBoard();


// 이미지가 로드 될 때마다 modal_board의 크기가 달라서
var ccc = 0;
$('.show-post-img').each(function(){
	// 이미지 로드 이벤트	
	this.onload = function(){
		ccc ++;
		// 맨 마지막에 실행되는 부분
		// 맨 마지막에 실행되는 부분
		// 맨 마지막에 실행되는 부분
		if ($('.show-post-img').size() ==  ccc){

			var captions = jQuery.parseJSON("<%=j @post.content %>".replace(/&quot;/g, "\""))
			var img_order = "<%=j @post.img_order %>".split(',')
			for (k = img_order.length - 1 ; k >= 0; k--){
				$(".show-post-img").each(function(idx){
					if (decodeURIComponent($(this).attr('src')).indexOf(img_order[k]) >= 0){
							$(this).parent().prepend("<center><div style='font-size:1.5em'>" + captions[img_order[k]] + "</div></center>");
							$(this).parent().prepend($(this));
							$(this).attr('id', 'show-post-img-' + k )
					}
				})
			}

			// 그냥 따로 할게 위에서 해도 될거같긴한데
			$('.show-post-img').click(function(){
				current_id = Number( $(this).attr('id').split('-')[3])
				// https://github.com/flesler/jquery.scrollTo
				nextID = '#show-post-img-' + (current_id + 1)
				if ($(nextID).length){
					$('#modal_board').scrollTo(nextID, {
						offset: -50	,
						duration: 200 ,
					})
				}
				else {
					$('#modal_board').scrollTo("#show-post-content", {
						offset: -50	,
						duration: 200 ,
					})
				}
			})


			// 내용을 채우고나선 반드시 이 함수를 호출해줘야한다
			changeWidthHeightModalBoard();
			// 스크롤 바꾸기
			$('#modal_board').perfectScrollbar();  
		}
		// 맨 마지막에 실행되는 부분
		// 맨 마지막에 실행되는 부분
		// 맨 마지막에 실행되는 부분
	}
})

// 추가적으로
// 안에서의 스크롤이 부모로 전달 되지 않게
//prevetScrollPropFrom('#modal_board')

$(function(){
	$('#moad_board').perfectScrollbar(); 
})
